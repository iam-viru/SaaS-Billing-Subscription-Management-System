<div class="dashboard-container">

   <div class="page-header">
    <div class="page-header-left">
      <h1>Dashboard Overview</h1>
      <p class="subtitle">Live metrics from customers and invoices</p>
    </div>

    <div class="page-header-right">
      <span class="range-label">Period</span>
      <div class="range-toggle">
        <button
          class="range-btn"
          [class.active]="range === '3m'"
          (click)="setRange('3m')">
          3M
        </button>
        <button
          class="range-btn"
          [class.active]="range === '6m'"
          (click)="setRange('6m')">
          6M
        </button>
        <button
          class="range-btn"
          [class.active]="range === '12m'"
          (click)="setRange('12m')">
          12M
        </button>
        <button
          class="range-btn"
          [class.active]="range === 'all'"
          (click)="setRange('all')">
          All
        </button>
      </div>
    </div>
  </div>


  <!-- KPI Cards -->
   <div class="kpi-grid">

  <!-- Total Customers -->
  <div class="card kpi-card">
    <div class="kpi-top">
      <div class="kpi-icon blue">
        <i class="icon icon-users"></i>
      </div>
      <div class="kpi-text">
        <div class="kpi-label">Total Customers</div>
        <div class="kpi-value">{{ metrics.totalCustomers }}</div>
        <div class="kpi-sub">Customers in the system</div>
      </div>
    </div>
  </div>

  <!-- Active Customers -->
  <div class="card kpi-card">
    <div class="kpi-top">
      <div class="kpi-icon green">
        <i class="icon icon-check"></i>
      </div>
      <div class="kpi-text">
        <div class="kpi-label">Active Customers</div>
        <div class="kpi-value">{{ metrics.activeCustomers }}</div>
        <div class="kpi-sub">{{ metrics.activeCustomers }} active</div>
      </div>
    </div>
  </div>

  <!-- MRR -->
  <div class="card kpi-card">
    <div class="kpi-top">
      <div class="kpi-icon purple">
        <i class="icon icon-cash"></i>
      </div>
      <div class="kpi-text">
        <div class="kpi-label">MRR</div>
        <div class="kpi-value">${{ metrics.monthlyRecurringRevenue }}</div>
        <div class="kpi-sub">Monthly recurring revenue</div>
      </div>
    </div>
  </div>

  <!-- Pending -->
  <div class="card kpi-card">
    <div class="kpi-top">
      <div class="kpi-icon orange">
        <i class="icon icon-clock"></i>
      </div>
      <div class="kpi-text">
        <div class="kpi-label">Pending Invoices</div>
        <div class="kpi-value">${{ metrics.pendingInvoicesAmount }}</div>
      </div>
    </div>
  </div>

  <!-- Overdue -->
  <div class="card kpi-card warning">
    <div class="kpi-top">
      <div class="kpi-icon red">
        <i class="icon icon-warning"></i>
      </div>
      <div class="kpi-text">
        <div class="kpi-label">Overdue</div>
        <div class="kpi-value">{{ metrics.overdueInvoicesCount }} / ${{ metrics.overdueInvoicesAmount }}</div>
        <div class="kpi-sub">Count / Amount</div>
      </div>
    </div>
  </div>

  <!-- Paid -->
  <div class="card kpi-card">
    <div class="kpi-top">
      <div class="kpi-icon teal">
        <i class="icon icon-check-circle"></i>
      </div>
      <div class="kpi-text">
        <div class="kpi-label">Paid (Total)</div>
        <div class="kpi-value">${{ metrics.paidInvoicesAmount }}</div>
      </div>
    </div>
  </div>

</div>


  <!-- Charts + Recent Invoices -->
  <div class="bottom-grid">

    <!-- Recent Invoices -->
    <div class="card recent-card">
      <h2>Recent Invoices</h2>

    <table class="table recent-table">
  <thead>
    <tr>
      <th>Invoice</th>
      <th>Customer</th>
      <th>Status</th>
      <th>Amount</th>
      <th>Issued</th>
    </tr>
  </thead>

  <tbody>
    <tr *ngFor="let inv of recentInvoices" (click)="openInvoice(inv)">
      <!-- Invoice # -->
      <td class="inv-num">
        <span class="strong">{{ inv.invoiceNumber }}</span>
      </td>

      <!-- Customer -->
      <td>
        <div class="cust-name">{{ inv.customerName }}</div>
        <div class="cust-email">{{ inv.customerEmail }}</div>
      </td>

      <!-- Status -->
      <td>
        <span class="status-pill"
              [class.paid]="inv.status === 'Paid'"
              [class.pending]="inv.status === 'Pending'"
              [class.overdue]="inv.status === 'Overdue'">
          {{ inv.status }}
        </span>
      </td>

      <!-- Amount -->
      <td class="amount">
        {{ inv.currency }} {{ inv.amount }}
      </td>

      <!-- Date -->
      <td class="issued">
        {{ inv.issueDate | date:'mediumDate' }}
      </td>
    </tr>
  </tbody>
</table>

    </div>

    <!-- Charts Section -->
    <div class="card chart-card">
      <h2>Revenue & Customers</h2>

      <div class="charts-grid">

        <!-- Line Chart -->
        <div class="chart-block">
          <h3 class="chart-title">Revenue by Month</h3>

 <canvas
  baseChart
  [data]="revenueChartData"
  [options]="revenueChartOptions"
  type="line">
</canvas>


        </div>

        <!-- Doughnut Chart -->
        <div class="chart-block">
          <h3 class="chart-title">Active Customers by Plan</h3>

          <canvas
            baseChart
            [data]="planChartData"
            [options]="planChartOptions"
            type="doughnut">
          </canvas>
        </div>

      </div>
    </div>
  </div>
</div>

<app-modal
  [visible]="showInvoiceModal"
  title="Invoice Details"
  (close)="closeInvoiceModal()">

  <ng-container *ngIf="selectedInvoice">

    <div class="invoice-details">
      <div class="inv-header">
        <div>
          <div class="inv-label">Invoice</div>
          <div class="inv-number">{{ selectedInvoice.invoiceNumber }}</div>
        </div>
        <div class="inv-status">
          <span class="status-pill"
                [class.paid]="selectedInvoice.status === 'Paid'"
                [class.pending]="selectedInvoice.status === 'Pending'"
                [class.overdue]="selectedInvoice.status === 'Overdue'">
            {{ selectedInvoice.status }}
          </span>
        </div>
      </div>

      <div class="inv-grid">
        <div class="inv-block">
          <div class="block-label">Customer</div>
          <div class="block-main">{{ selectedInvoice.customerName }}</div>
          <div class="block-sub">{{ selectedInvoice.customerEmail }}</div>
        </div>

        <div class="inv-block">
          <div class="block-label">Plan</div>
          <div class="block-main">{{ selectedInvoice.plan }}</div>
        </div>

        <div class="inv-block">
          <div class="block-label">Amount</div>
          <div class="block-main">
            {{ selectedInvoice.currency }} {{ selectedInvoice.amount }}
          </div>
        </div>

        <div class="inv-block">
          <div class="block-label">Issued</div>
          <div class="block-main">
            {{ selectedInvoice.issueDate | date:'mediumDate' }}
          </div>
        </div>

        <div class="inv-block">
          <div class="block-label">Due</div>
          <div class="block-main">
            {{ selectedInvoice.dueDate | date:'mediumDate' }}
          </div>
        </div>
      </div>

      <div class="inv-footer">
        <button class="btn btn-soft" type="button" (click)="closeInvoiceModal()">
          Close
        </button>
      </div>
    </div>

  </ng-container>
</app-modal>

